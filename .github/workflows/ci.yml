#
# https://docs.github.com/en/actions
# https://github.com/actions
#

name: CI
on: [pull_request, push]
jobs:
  lint:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with: {python-version: "3.8"}
      - run: python -m pip install tox wheel
      - run: python -m tox -r -e lint -- --color=yes
  test:
    runs-on: "${{matrix.pick.OS}}"
    strategy:
      fail-fast: false
      matrix:
        pick:
          - {OS: "ubuntu-16.04", ARCH: "x64", PY: "3.6", CRYPTO: "21"}
          - {OS: "ubuntu-18.04", ARCH: "x64", PY: "3.7", CRYPTO: "27"}
          - {OS: "ubuntu-20.04", ARCH: "x64", PY: "3.8", CRYPTO: "31"}
          - {OS: "ubuntu-20.04", ARCH: "x64", PY: "3.9", CRYPTO: "34"}
          - {OS: "windows-2016", ARCH: "x86", PY: "3.6", CRYPTO: "32"}
          - {OS: "windows-2016", ARCH: "x64", PY: "3.7", CRYPTO: "33"}
          - {OS: "windows-2019", ARCH: "x86", PY: "3.8", CRYPTO: "34"}
          - {OS: "windows-2019", ARCH: "x64", PY: "3.9", CRYPTO: "34"}
          - {OS: "macos-10.15", ARCH: "x64", PY: "3.8", CRYPTO: "34"}
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: "${{matrix.pick.PY}}"
          architecture: "${{matrix.pick.ARCH}}"
      - run: python -m pip install tox wheel
      - run: python -m tox -r -- --color=yes
        env:
          TOXENV: "py3-cryptography${{matrix.pick.CRYPTO}}"

